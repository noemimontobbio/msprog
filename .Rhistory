library(readxl)
library(dplyr)
# library(msprog)
source('/Users/nmontobbio/code/MSprog/R-MSprog/msprog/R/MSprog.R')
source('/Users/nmontobbio/code/MSprog/R-MSprog/msprog/R/event_testing.R')
source('/Users/nmontobbio/code/MSprog/R-MSprog/msprog/R/relapse_indep_from_bounds.R')
source('/Users/nmontobbio/code/MSprog/R-MSprog/msprog/R/msprog_methods.R')
#####################################################################################
# Settings
# Data
value_col <- 'AVAL' #CLINICAL_EDSS_Score_Observed'
date_col <- 'ADT' #VISIT_Date'
rdate_col <- 'DATA_RELAPSE' #'VISIT_Date'
subj_col <- 'SUBJID' #'RID'
rsubj_col <- 'SUBJID' #'RID'
date_format <- NULL
# Progression settings
outcome <- 'edss' # 'edss','nhpt','t25fw','sdmt'
conf_weeks <- 12 # period before confirmation (weeks)
conf_tol_days <- 0 # tolerance window for confirmation visit (days): [t(weeks)-conf_tol(days), t(weeks)+conf_tol(days)]
conf_unbounded_right <- TRUE # if TRUE, confirmation window is [t(weeks)-conf_tol(days), inf)
require_sust_weeks <- Inf # count an event as such only if sustained for _ weeks from confirmation
relapse_to_bl <- 30
relapse_to_event <- 0
relapse_to_conf <- 0
relapse_assoc <- 90
event <- 'firstprogtype'   # 'first' [only the very first event - improvement or progression]
# 'firsteach' [first improvement and first progression]
# 'firstprog' [first progression]
# 'firstprogtype' [first progression of each kind - PIRA, RAW, undefined]
# 'multiple' [all events - to use coupled with roving baseline!]
baseline <- 'roving' # 'fixed', 'roving', 'roving_impr'
relapse_indep <- NULL #relapse_indep_from_bounds(0,0,90,30,90,30)
sub_threshold <- F # if TRUE, include confirmed sub-threshold events for roving baseline
relapse_rebl <- T # if TRUE, search for PIRA events again with post-relapse re-baseline
min_value <- NULL # only consider as progressions those events where the outcome is >= min_value
prog_last_visit <- F # if TRUE, include progressions occurring at last visit (i.e. with no confirmation!)
verbose <- 1 # 0[print no info], 1[print concise info], 2[print extended info]
include_dates <- T # if TRUE, include baseline and event dates
include_value <- T # if TRUE, include outcome value at baseline and at event
include_stable <- T # if TRUE, include subjects with no events in extended info
# Custom delta function
delta_fun <- NULL
#####################################################################################
# SETUP
# Load data
data <- read_excel("/Users/nmontobbio/Library/CloudStorage/OneDrive-unige.it/DATA/MSprog-EXPAND/edss.xlsx")
relapse <- read_excel("/Users/nmontobbio/Library/CloudStorage/OneDrive-unige.it/DATA/MSprog-EXPAND/relapse.xlsx")
# Remove missing values
data <- data[complete.cases(data[ , c(subj_col, value_col, date_col)]), ]
relapse <- relapse[complete.cases(relapse[ , c(rsubj_col, rdate_col)]), ]
#####################################################################################
# Compute progression
subj_all = unique(data[[subj_col]])
subjects = subj_all[1:100]
# subjects <- NULL
output <- MSprog(data, subj_col, value_col, date_col, outcome=outcome, subjects=subjects, date_format=date_format,
relapse=relapse, rdate_col=rdate_col, rsubj_col=rsubj_col,
delta_fun=delta_fun, conf_weeks=conf_weeks, conf_tol_days=conf_tol_days, conf_unbounded_right=conf_unbounded_right,
require_sust_weeks=require_sust_weeks, relapse_to_bl=relapse_to_bl, relapse_to_event=relapse_to_event,
relapse_to_conf=relapse_to_conf, relapse_assoc=relapse_assoc, event=event, baseline=baseline,
relapse_indep=relapse_indep, sub_threshold=sub_threshold, relapse_rebl=relapse_rebl, min_value=min_value,
prog_last_visit=prog_last_visit, include_dates=include_dates, include_stable=include_stable,
include_value=include_value, verbose=verbose)
rm(list=ls())
library(readxl)
library(dplyr)
# library(msprog)
source('/Users/nmontobbio/code/MSprog/R-MSprog/msprog/R/MSprog.R')
source('/Users/nmontobbio/code/MSprog/R-MSprog/msprog/R/event_testing.R')
source('/Users/nmontobbio/code/MSprog/R-MSprog/msprog/R/relapse_indep_from_bounds.R')
source('/Users/nmontobbio/code/MSprog/R-MSprog/msprog/R/msprog_methods.R')
#####################################################################################
# Settings
# Data
value_col <- 'AVAL' #CLINICAL_EDSS_Score_Observed'
date_col <- 'ADT' #VISIT_Date'
rdate_col <- 'DATA_RELAPSE' #'VISIT_Date'
subj_col <- 'SUBJID' #'RID'
rsubj_col <- 'SUBJID' #'RID'
date_format <- NULL
# Progression settings
outcome <- 'edss' # 'edss','nhpt','t25fw','sdmt'
conf_weeks <- 12 # period before confirmation (weeks)
conf_tol_days <- 0 # tolerance window for confirmation visit (days): [t(weeks)-conf_tol(days), t(weeks)+conf_tol(days)]
conf_unbounded_right <- TRUE # if TRUE, confirmation window is [t(weeks)-conf_tol(days), inf)
require_sust_weeks <- Inf # count an event as such only if sustained for _ weeks from confirmation
relapse_to_bl <- 30
relapse_to_event <- 0
relapse_to_conf <- 0
relapse_assoc <- 90
event <- 'firstprogtype'   # 'first' [only the very first event - improvement or progression]
# 'firsteach' [first improvement and first progression]
# 'firstprog' [first progression]
# 'firstprogtype' [first progression of each kind - PIRA, RAW, undefined]
# 'multiple' [all events - to use coupled with roving baseline!]
baseline <- 'roving' # 'fixed', 'roving', 'roving_impr'
relapse_indep <- NULL #relapse_indep_from_bounds(0,0,90,30,90,30)
sub_threshold <- F # if TRUE, include confirmed sub-threshold events for roving baseline
relapse_rebl <- T # if TRUE, search for PIRA events again with post-relapse re-baseline
min_value <- NULL # only consider as progressions those events where the outcome is >= min_value
prog_last_visit <- F # if TRUE, include progressions occurring at last visit (i.e. with no confirmation!)
verbose <- 1 # 0[print no info], 1[print concise info], 2[print extended info]
include_dates <- T # if TRUE, include baseline and event dates
include_value <- T # if TRUE, include outcome value at baseline and at event
include_stable <- T # if TRUE, include subjects with no events in extended info
# Custom delta function
delta_fun <- NULL
#####################################################################################
# SETUP
# Load data
data <- read_excel("/Users/nmontobbio/Library/CloudStorage/OneDrive-unige.it/DATA/MSprog-EXPAND/edss.xlsx")
relapse <- read_excel("/Users/nmontobbio/Library/CloudStorage/OneDrive-unige.it/DATA/MSprog-EXPAND/relapse.xlsx")
# Remove missing values
data <- data[complete.cases(data[ , c(subj_col, value_col, date_col)]), ]
relapse <- relapse[complete.cases(relapse[ , c(rsubj_col, rdate_col)]), ]
#####################################################################################
# Compute progression
subj_all = unique(data[[subj_col]])
subjects = subj_all[1:100]
# subjects <- NULL
output <- MSprog(data, subj_col, value_col, date_col, outcome=outcome, subjects=subjects, date_format=date_format,
relapse=relapse, rdate_col=rdate_col, rsubj_col=rsubj_col,
delta_fun=delta_fun, conf_weeks=conf_weeks, conf_tol_days=conf_tol_days, conf_unbounded_right=conf_unbounded_right,
require_sust_weeks=require_sust_weeks, relapse_to_bl=relapse_to_bl, relapse_to_event=relapse_to_event,
relapse_to_conf=relapse_to_conf, relapse_assoc=relapse_assoc, event=event, baseline=baseline,
relapse_indep=relapse_indep, sub_threshold=sub_threshold, relapse_rebl=relapse_rebl, min_value=min_value,
prog_last_visit=prog_last_visit, include_dates=include_dates, include_stable=include_stable,
include_value=include_value, verbose=verbose)
rm(list=ls())
library(readxl)
library(dplyr)
# library(msprog)
source('/Users/nmontobbio/code/MSprog/R-MSprog/msprog/R/MSprog.R')
source('/Users/nmontobbio/code/MSprog/R-MSprog/msprog/R/event_testing.R')
source('/Users/nmontobbio/code/MSprog/R-MSprog/msprog/R/relapse_indep_from_bounds.R')
source('/Users/nmontobbio/code/MSprog/R-MSprog/msprog/R/msprog_methods.R')
#####################################################################################
# Settings
# Data
value_col <- 'AVAL' #CLINICAL_EDSS_Score_Observed'
date_col <- 'ADT' #VISIT_Date'
rdate_col <- 'DATA_RELAPSE' #'VISIT_Date'
subj_col <- 'SUBJID' #'RID'
rsubj_col <- 'SUBJID' #'RID'
date_format <- NULL
# Progression settings
outcome <- 'edss' # 'edss','nhpt','t25fw','sdmt'
conf_weeks <- 12 # period before confirmation (weeks)
conf_tol_days <- 0 # tolerance window for confirmation visit (days): [t(weeks)-conf_tol(days), t(weeks)+conf_tol(days)]
conf_unbounded_right <- TRUE # if TRUE, confirmation window is [t(weeks)-conf_tol(days), inf)
require_sust_weeks <- Inf # count an event as such only if sustained for _ weeks from confirmation
relapse_to_bl <- 30
relapse_to_event <- 0
relapse_to_conf <- 0
relapse_assoc <- 90
event <- 'firstprogtype'   # 'first' [only the very first event - improvement or progression]
# 'firsteach' [first improvement and first progression]
# 'firstprog' [first progression]
# 'firstprogtype' [first progression of each kind - PIRA, RAW, undefined]
# 'multiple' [all events - to use coupled with roving baseline!]
baseline <- 'roving' # 'fixed', 'roving', 'roving_impr'
relapse_indep <- NULL #relapse_indep_from_bounds(0,0,90,30,90,30)
sub_threshold <- F # if TRUE, include confirmed sub-threshold events for roving baseline
relapse_rebl <- T # if TRUE, search for PIRA events again with post-relapse re-baseline
min_value <- NULL # only consider as progressions those events where the outcome is >= min_value
prog_last_visit <- F # if TRUE, include progressions occurring at last visit (i.e. with no confirmation!)
verbose <- 1 # 0[print no info], 1[print concise info], 2[print extended info]
include_dates <- T # if TRUE, include baseline and event dates
include_value <- T # if TRUE, include outcome value at baseline and at event
include_stable <- T # if TRUE, include subjects with no events in extended info
# Custom delta function
delta_fun <- NULL
#####################################################################################
# SETUP
# Load data
data <- read_excel("/Users/nmontobbio/Library/CloudStorage/OneDrive-unige.it/DATA/MSprog-EXPAND/edss.xlsx")
relapse <- read_excel("/Users/nmontobbio/Library/CloudStorage/OneDrive-unige.it/DATA/MSprog-EXPAND/relapse.xlsx")
# Remove missing values
data <- data[complete.cases(data[ , c(subj_col, value_col, date_col)]), ]
relapse <- relapse[complete.cases(relapse[ , c(rsubj_col, rdate_col)]), ]
#####################################################################################
# Compute progression
subj_all = unique(data[[subj_col]])
subjects = subj_all[1:100]
# subjects <- NULL
output <- MSprog(data, subj_col, value_col, date_col, outcome=outcome, subjects=subjects, date_format=date_format,
relapse=relapse, rdate_col=rdate_col, rsubj_col=rsubj_col,
delta_fun=delta_fun, conf_weeks=conf_weeks, conf_tol_days=conf_tol_days, conf_unbounded_right=conf_unbounded_right,
require_sust_weeks=require_sust_weeks, relapse_to_bl=relapse_to_bl, relapse_to_event=relapse_to_event,
relapse_to_conf=relapse_to_conf, relapse_assoc=relapse_assoc, event=event, baseline=baseline,
relapse_indep=relapse_indep, sub_threshold=sub_threshold, relapse_rebl=relapse_rebl, min_value=min_value,
prog_last_visit=prog_last_visit, include_dates=include_dates, include_stable=include_stable,
include_value=include_value, verbose=verbose)
count <- event_count(output) #output[[1]] # summary of detected events for each subject
res <- results(output) #output[[2]] # extended info on event sequence for each subject
s = output$prog_settings
print(count)
print(res)
criteria_text(output)
#####################################################################################
# Create toy data
# toydata_visits = read_excel("/Users/nmontobbio/Library/CloudStorage/OneDrive-unige.it/DATA/MSprog_toydata.xlsx", sheet='visits')
# toydata_visits$id = as.character(toydata_visits$id)
# toydata_visits$date = as.Date(toydata_visits$date)
# toydata_relapses = read_excel("/Users/nmontobbio/Library/CloudStorage/OneDrive-unige.it/DATA/MSprog_toydata.xlsx", sheet='relapses')
# toydata_relapses$id = as.character(toydata_relapses$id)
# toydata_relapses$date = as.Date(toydata_relapses$date)
# save(toydata_visits, file="data/toydata_visits.RData")
# save(toydata_relapses, file="data/toydata_relapses.RData")
warnings()
rm(list=ls())
library(readxl)
library(dplyr)
# library(msprog)
source('/Users/nmontobbio/code/MSprog/R-MSprog/msprog/R/MSprog.R')
source('/Users/nmontobbio/code/MSprog/R-MSprog/msprog/R/event_testing.R')
source('/Users/nmontobbio/code/MSprog/R-MSprog/msprog/R/relapse_indep_from_bounds.R')
source('/Users/nmontobbio/code/MSprog/R-MSprog/msprog/R/msprog_methods.R')
#####################################################################################
# Settings
# Data
value_col <- 'AVAL' #CLINICAL_EDSS_Score_Observed'
date_col <- 'ADT' #VISIT_Date'
rdate_col <- 'DATA_RELAPSE' #'VISIT_Date'
subj_col <- 'SUBJID' #'RID'
rsubj_col <- 'SUBJID' #'RID'
date_format <- NULL
# Progression settings
outcome <- 'edss' # 'edss','nhpt','t25fw','sdmt'
conf_weeks <- 12 # period before confirmation (weeks)
conf_tol_days <- 0 # tolerance window for confirmation visit (days): [t(weeks)-conf_tol(days), t(weeks)+conf_tol(days)]
conf_unbounded_right <- TRUE # if TRUE, confirmation window is [t(weeks)-conf_tol(days), inf)
require_sust_weeks <- Inf # count an event as such only if sustained for _ weeks from confirmation
relapse_to_bl <- 30
relapse_to_event <- 0
relapse_to_conf <- 0
relapse_assoc <- 90
event <- 'firstprogtype'   # 'first' [only the very first event - improvement or progression]
# 'firsteach' [first improvement and first progression]
# 'firstprog' [first progression]
# 'firstprogtype' [first progression of each kind - PIRA, RAW, undefined]
# 'multiple' [all events - to use coupled with roving baseline!]
baseline <- 'roving' # 'fixed', 'roving', 'roving_impr'
relapse_indep <- NULL #relapse_indep_from_bounds(0,0,90,30,90,30)
sub_threshold <- F # if TRUE, include confirmed sub-threshold events for roving baseline
relapse_rebl <- T # if TRUE, search for PIRA events again with post-relapse re-baseline
min_value <- NULL # only consider as progressions those events where the outcome is >= min_value
prog_last_visit <- F # if TRUE, include progressions occurring at last visit (i.e. with no confirmation!)
verbose <- 1 # 0[print no info], 1[print concise info], 2[print extended info]
include_dates <- T # if TRUE, include baseline and event dates
include_value <- T # if TRUE, include outcome value at baseline and at event
include_stable <- T # if TRUE, include subjects with no events in extended info
# Custom delta function
delta_fun <- NULL
#####################################################################################
# SETUP
# Load data
data <- read_excel("/Users/nmontobbio/Library/CloudStorage/OneDrive-unige.it/DATA/MSprog-EXPAND/edss.xlsx")
relapse <- read_excel("/Users/nmontobbio/Library/CloudStorage/OneDrive-unige.it/DATA/MSprog-EXPAND/relapse.xlsx")
# Remove missing values
data <- data[complete.cases(data[ , c(subj_col, value_col, date_col)]), ]
relapse <- relapse[complete.cases(relapse[ , c(rsubj_col, rdate_col)]), ]
#####################################################################################
# Compute progression
subj_all = unique(data[[subj_col]])
subjects = subj_all[1:100]
# subjects <- NULL
output <- MSprog(data, subj_col, value_col, date_col, outcome=outcome, subjects=subjects, date_format=date_format,
relapse=relapse, rdate_col=rdate_col, rsubj_col=rsubj_col,
delta_fun=delta_fun, conf_weeks=conf_weeks, conf_tol_days=conf_tol_days, conf_unbounded_right=conf_unbounded_right,
require_sust_weeks=require_sust_weeks, relapse_to_bl=relapse_to_bl, relapse_to_event=relapse_to_event,
relapse_to_conf=relapse_to_conf, relapse_assoc=relapse_assoc, event=event, baseline=baseline,
relapse_indep=relapse_indep, sub_threshold=sub_threshold, relapse_rebl=relapse_rebl, min_value=min_value,
prog_last_visit=prog_last_visit, include_dates=include_dates, include_stable=include_stable,
include_value=include_value, verbose=verbose)
count <- event_count(output) #output[[1]] # summary of detected events for each subject
res <- results(output) #output[[2]] # extended info on event sequence for each subject
s = output$prog_settings
print(count)
print(res)
criteria_text(output)
#####################################################################################
# Create toy data
# toydata_visits = read_excel("/Users/nmontobbio/Library/CloudStorage/OneDrive-unige.it/DATA/MSprog_toydata.xlsx", sheet='visits')
# toydata_visits$id = as.character(toydata_visits$id)
# toydata_visits$date = as.Date(toydata_visits$date)
# toydata_relapses = read_excel("/Users/nmontobbio/Library/CloudStorage/OneDrive-unige.it/DATA/MSprog_toydata.xlsx", sheet='relapses')
# toydata_relapses$id = as.character(toydata_relapses$id)
# toydata_relapses$date = as.Date(toydata_relapses$date)
# save(toydata_visits, file="data/toydata_visits.RData")
# save(toydata_relapses, file="data/toydata_relapses.RData")
rm(list=ls())
library(readxl)
library(dplyr)
library(msprog)
# source('/Users/nmontobbio/code/MSprog/R-MSprog/msprog/R/MSprog.R')
# source('/Users/nmontobbio/code/MSprog/R-MSprog/msprog/R/event_testing.R')
# source('/Users/nmontobbio/code/MSprog/R-MSprog/msprog/R/relapse_indep_from_bounds.R')
# source('/Users/nmontobbio/code/MSprog/R-MSprog/msprog/R/msprog_methods.R')
#####################################################################################
# Settings
# Data
value_col <- 'AVAL' #CLINICAL_EDSS_Score_Observed'
date_col <- 'ADT' #VISIT_Date'
rdate_col <- 'DATA_RELAPSE' #'VISIT_Date'
subj_col <- 'SUBJID' #'RID'
rsubj_col <- 'SUBJID' #'RID'
date_format <- NULL
# Progression settings
outcome <- 'edss' # 'edss','nhpt','t25fw','sdmt'
conf_weeks <- 12 # period before confirmation (weeks)
conf_tol_days <- 0 # tolerance window for confirmation visit (days): [t(weeks)-conf_tol(days), t(weeks)+conf_tol(days)]
conf_unbounded_right <- TRUE # if TRUE, confirmation window is [t(weeks)-conf_tol(days), inf)
require_sust_weeks <- Inf # count an event as such only if sustained for _ weeks from confirmation
relapse_to_bl <- 30
relapse_to_event <- 0
relapse_to_conf <- 0
relapse_assoc <- 90
event <- 'firstprogtype'   # 'first' [only the very first event - improvement or progression]
# 'firsteach' [first improvement and first progression]
# 'firstprog' [first progression]
# 'firstprogtype' [first progression of each kind - PIRA, RAW, undefined]
# 'multiple' [all events - to use coupled with roving baseline!]
baseline <- 'roving' # 'fixed', 'roving', 'roving_impr'
relapse_indep <- NULL #relapse_indep_from_bounds(0,0,90,30,90,30)
sub_threshold <- F # if TRUE, include confirmed sub-threshold events for roving baseline
relapse_rebl <- T # if TRUE, search for PIRA events again with post-relapse re-baseline
min_value <- NULL # only consider as progressions those events where the outcome is >= min_value
prog_last_visit <- F # if TRUE, include progressions occurring at last visit (i.e. with no confirmation!)
verbose <- 1 # 0[print no info], 1[print concise info], 2[print extended info]
include_dates <- T # if TRUE, include baseline and event dates
include_value <- T # if TRUE, include outcome value at baseline and at event
include_stable <- T # if TRUE, include subjects with no events in extended info
# Custom delta function
delta_fun <- NULL
#####################################################################################
# SETUP
# Load data
data <- read_excel("/Users/nmontobbio/Library/CloudStorage/OneDrive-unige.it/DATA/MSprog-EXPAND/edss.xlsx")
relapse <- read_excel("/Users/nmontobbio/Library/CloudStorage/OneDrive-unige.it/DATA/MSprog-EXPAND/relapse.xlsx")
# Remove missing values
data <- data[complete.cases(data[ , c(subj_col, value_col, date_col)]), ]
relapse <- relapse[complete.cases(relapse[ , c(rsubj_col, rdate_col)]), ]
#####################################################################################
# Compute progression
subj_all = unique(data[[subj_col]])
subjects = subj_all[1:100]
# subjects <- NULL
output <- MSprog(data, subj_col, value_col, date_col, outcome=outcome, subjects=subjects, date_format=date_format,
relapse=relapse, rdate_col=rdate_col, rsubj_col=rsubj_col,
delta_fun=delta_fun, conf_weeks=conf_weeks, conf_tol_days=conf_tol_days, conf_unbounded_right=conf_unbounded_right,
require_sust_weeks=require_sust_weeks, relapse_to_bl=relapse_to_bl, relapse_to_event=relapse_to_event,
relapse_to_conf=relapse_to_conf, relapse_assoc=relapse_assoc, event=event, baseline=baseline,
relapse_indep=relapse_indep, sub_threshold=sub_threshold, relapse_rebl=relapse_rebl, min_value=min_value,
prog_last_visit=prog_last_visit, include_dates=include_dates, include_stable=include_stable,
include_value=include_value, verbose=verbose)
count <- event_count(output) #output[[1]] # summary of detected events for each subject
res <- results(output) #output[[2]] # extended info on event sequence for each subject
s = output$prog_settings
print(count)
print(res)
criteria_text(output)
#####################################################################################
# Create toy data
# toydata_visits = read_excel("/Users/nmontobbio/Library/CloudStorage/OneDrive-unige.it/DATA/MSprog_toydata.xlsx", sheet='visits')
# toydata_visits$id = as.character(toydata_visits$id)
# toydata_visits$date = as.Date(toydata_visits$date)
# toydata_relapses = read_excel("/Users/nmontobbio/Library/CloudStorage/OneDrive-unige.it/DATA/MSprog_toydata.xlsx", sheet='relapses')
# toydata_relapses$id = as.character(toydata_relapses$id)
# toydata_relapses$date = as.Date(toydata_relapses$date)
# save(toydata_visits, file="data/toydata_visits.RData")
# save(toydata_relapses, file="data/toydata_relapses.RData")
filter(count, PIRA==1)['SUBJID']
filter(count, PIRA==1)
names(filter(count, PIRA==1))
indexx(filter(count, PIRA==1))
index(filter(count, PIRA==1))
rownames(filter(count, PIRA==1))
rm(list=ls())
library(readxl)
library(dplyr)
# library(msprog)
source('/Users/nmontobbio/code/MSprog/R-MSprog/msprog/R/MSprog.R')
source('/Users/nmontobbio/code/MSprog/R-MSprog/msprog/R/event_testing.R')
source('/Users/nmontobbio/code/MSprog/R-MSprog/msprog/R/relapse_indep_from_bounds.R')
source('/Users/nmontobbio/code/MSprog/R-MSprog/msprog/R/msprog_methods.R')
#####################################################################################
# Settings
# Data
value_col <- 'AVAL' #CLINICAL_EDSS_Score_Observed'
date_col <- 'ADT' #VISIT_Date'
rdate_col <- 'DATA_RELAPSE' #'VISIT_Date'
subj_col <- 'SUBJID' #'RID'
rsubj_col <- 'SUBJID' #'RID'
date_format <- NULL
# Progression settings
outcome <- 'edss' # 'edss','nhpt','t25fw','sdmt'
conf_weeks <- 12 # period before confirmation (weeks)
conf_tol_days <- 0 # tolerance window for confirmation visit (days): [t(weeks)-conf_tol(days), t(weeks)+conf_tol(days)]
conf_unbounded_right <- TRUE # if TRUE, confirmation window is [t(weeks)-conf_tol(days), inf)
require_sust_weeks <- Inf # count an event as such only if sustained for _ weeks from confirmation
relapse_to_bl <- 30
relapse_to_event <- 0
relapse_to_conf <- 0
relapse_assoc <- 90
event <- 'firstprogtype'   # 'first' [only the very first event - improvement or progression]
# 'firsteach' [first improvement and first progression]
# 'firstprog' [first progression]
# 'firstprogtype' [first progression of each kind - PIRA, RAW, undefined]
# 'multiple' [all events - to use coupled with roving baseline!]
baseline <- 'roving' # 'fixed', 'roving', 'roving_impr'
relapse_indep <- NULL #relapse_indep_from_bounds(0,0,90,30,90,30)
sub_threshold <- F # if TRUE, include confirmed sub-threshold events for roving baseline
relapse_rebl <- T # if TRUE, search for PIRA events again with post-relapse re-baseline
min_value <- NULL # only consider as progressions those events where the outcome is >= min_value
prog_last_visit <- F # if TRUE, include progressions occurring at last visit (i.e. with no confirmation!)
verbose <- 1 # 0[print no info], 1[print concise info], 2[print extended info]
include_dates <- T # if TRUE, include baseline and event dates
include_value <- T # if TRUE, include outcome value at baseline and at event
include_stable <- T # if TRUE, include subjects with no events in extended info
# Custom delta function
delta_fun <- NULL
#####################################################################################
# SETUP
# Load data
data <- read_excel("/Users/nmontobbio/Library/CloudStorage/OneDrive-unige.it/DATA/MSprog-EXPAND/edss.xlsx")
relapse <- read_excel("/Users/nmontobbio/Library/CloudStorage/OneDrive-unige.it/DATA/MSprog-EXPAND/relapse.xlsx")
# Remove missing values
data <- data[complete.cases(data[ , c(subj_col, value_col, date_col)]), ]
relapse <- relapse[complete.cases(relapse[ , c(rsubj_col, rdate_col)]), ]
#####################################################################################
# Compute progression
subj_all = unique(data[[subj_col]])
subjects = subj_all[1:100]
# subjects <- NULL
output <- MSprog(data, subj_col, value_col, date_col, outcome=outcome, subjects=subjects, date_format=date_format,
relapse=relapse, rdate_col=rdate_col, rsubj_col=rsubj_col,
delta_fun=delta_fun, conf_weeks=conf_weeks, conf_tol_days=conf_tol_days, conf_unbounded_right=conf_unbounded_right,
require_sust_weeks=require_sust_weeks, relapse_to_bl=relapse_to_bl, relapse_to_event=relapse_to_event,
relapse_to_conf=relapse_to_conf, relapse_assoc=relapse_assoc, event=event, baseline=baseline,
relapse_indep=relapse_indep, sub_threshold=sub_threshold, relapse_rebl=relapse_rebl, min_value=min_value,
prog_last_visit=prog_last_visit, include_dates=include_dates, include_stable=include_stable,
include_value=include_value, verbose=verbose)
count <- event_count(output) #output[[1]] # summary of detected events for each subject
res <- results(output) #output[[2]] # extended info on event sequence for each subject
s = output$prog_settings
print(count)
print(res)
criteria_text(output)
#####################################################################################
# Create toy data
# toydata_visits = read_excel("/Users/nmontobbio/Library/CloudStorage/OneDrive-unige.it/DATA/MSprog_toydata.xlsx", sheet='visits')
# toydata_visits$id = as.character(toydata_visits$id)
# toydata_visits$date = as.Date(toydata_visits$date)
# toydata_relapses = read_excel("/Users/nmontobbio/Library/CloudStorage/OneDrive-unige.it/DATA/MSprog_toydata.xlsx", sheet='relapses')
# toydata_relapses$id = as.character(toydata_relapses$id)
# toydata_relapses$date = as.Date(toydata_relapses$date)
# save(toydata_visits, file="data/toydata_visits.RData")
# save(toydata_relapses, file="data/toydata_relapses.RData")
aaa = c("1004003", "1005011", "1005013" ,"1005015", "1005016", "1007004" ,"1009002" ,"1009006", "1009008", "1009013",
"1009016", "1025002", "1041005", "1041006", "1042001", "1042006", "1061001", "1062001")
rownames(filter(count, PIRA==1))
filter(data, SUBJID=="1009017")
filter(relapse, SUBJID=="1009017")
filter(res, SUBJID=="1009017")
baseline
relapse_rebl
relapse_indep
s$relapse_indep
event
require_sust_weeks
# UPDATE DOCS
# -----------
roxygen2::roxygenise()
rm(list = c("compute_delta", "criteria_text", "event_count", "is_event", "MSprog", "relapse_indep_from_bounds", "results"))
# UPDATE DOCS
# -----------
roxygen2::roxygenise()
output <- MSprog(toydata_visits, 'id', 'EDSS', 'date', 'edss',
relapse=toydata_relapses,
conf_weeks=c(12,24), conf_tol_days=0, conf_unbounded_right=TRUE,
event='firstPIRA', baseline='roving',
relapse_indep=relapse_indep_from_bounds(0,0,90,30,90,30),
verbose=2)
# BUILD PACKAGE
# -------------
devtools::build()
library(msprog)
devtools::install()
# BUILD PACKAGE
# -------------
devtools::build() # oppure: Build > Build Source Package
devtools::install()
# SAVE UPDATED VIGNETTES
# ----------------------
rmarkdown::render('vignettes/vignette0.Rmd', output_dir='../') # or save in ./ and add to Rbuildignore??
# SAVE UPDATED VIGNETTES
# ----------------------
rmarkdown::render('vignettes/vignette0.Rmd', output_dir='../') # or save in ./ and add to Rbuildignore??
# SAVE UPDATED VIGNETTES
# ----------------------
rmarkdown::render('vignettes/vignette0.Rmd', output_dir='../') # or save in ./ and add to Rbuildignore??
rmarkdown::render('vignettes/vignette_PIRA.Rmd', output_dir='../')
# BUILD AND INSTALL PACKAGE
# -------------------------
devtools::build() # oppure: Build > Build Source Package
devtools::install() # oppure: (in Build tab) Install
library(msprog)
# SAVE UPDATED VIGNETTES
# ----------------------
rmarkdown::render('vignettes/vignette0.Rmd', output_dir='../') # or save in ./ and add to Rbuildignore??
